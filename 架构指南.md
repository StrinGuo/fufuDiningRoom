# å®¢æˆ·ç«¯å¼€å‘æ¶æ„æŒ‡å—

## ğŸ¯ æ ¸å¿ƒé—®é¢˜ï¼šåœ¨å“ªé‡Œå†™å®¢æˆ·ç«¯ä»£ç ï¼Ÿ

### ç­”æ¡ˆï¼š`lib/` ç›®å½•

**æ‰€æœ‰å®¢æˆ·ç«¯ä»£ç éƒ½åœ¨ `lib/` ç›®å½•ä¸‹ç¼–å†™ï¼**

Flutter é¡¹ç›®çš„ç»“æ„ç‰¹ç‚¹ï¼š
- `lib/` = ä½ çš„ä¸šåŠ¡ä»£ç ï¼ˆDart/Flutterï¼‰
- `android/`, `ios/`, `web/` ç­‰ = å¹³å°ç‰¹å®šé…ç½®ï¼ˆé€šå¸¸ä¸éœ€è¦ä¿®æ”¹ï¼‰

---

## ğŸ“‚ æ¨èçš„ç›®å½•ç»“æ„ï¼ˆç«‹å³å¼€å§‹ä½¿ç”¨ï¼‰

### æœ€å°åŒ–ç»“æ„ï¼ˆé€‚åˆå½“å‰é˜¶æ®µï¼‰

```
lib/
â”œâ”€â”€ main.dart                 # âœ… åº”ç”¨å…¥å£ï¼ˆå·²æœ‰ï¼‰
â”œâ”€â”€ config/
â”‚   â””â”€â”€ supabase_config.dart  # âš ï¸ éœ€è¦åˆ›å»ºï¼šSupabase é…ç½®
â”œâ”€â”€ models/                   # âš ï¸ éœ€è¦åˆ›å»ºï¼šæ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ user_model.dart
â”œâ”€â”€ screens/                  # âš ï¸ éœ€è¦åˆ›å»ºï¼šé¡µé¢
â”‚   â”œâ”€â”€ home_screen.dart
â”‚   â”œâ”€â”€ login_screen.dart
â”‚   â””â”€â”€ menu_screen.dart
â”œâ”€â”€ widgets/                  # âš ï¸ éœ€è¦åˆ›å»ºï¼šå¯å¤ç”¨ç»„ä»¶
â”‚   â””â”€â”€ menu_card.dart
â””â”€â”€ services/                 # âš ï¸ éœ€è¦åˆ›å»ºï¼šæ•°æ®æœåŠ¡
    â””â”€â”€ auth_service.dart
```

---

## ğŸ›ï¸ æ¶æ„æ¨¡å¼è¯¦è§£

### å½“å‰æ¶æ„ï¼šå•æ–‡ä»¶æ¶æ„ï¼ˆä¸æ¨èç»§ç»­ï¼‰

```
lib/
â””â”€â”€ main.dart  â† æ‰€æœ‰ä»£ç éƒ½åœ¨è¿™é‡Œï¼ˆå½“å‰çŠ¶æ€ï¼‰
```

**é—®é¢˜**ï¼š
- ä»£ç éš¾ä»¥ç»´æŠ¤
- æ— æ³•å¤ç”¨
- æ— æ³•æµ‹è¯•
- ä¸é€‚åˆå›¢é˜Ÿåä½œ

---

### æ¨èæ¶æ„ï¼šåˆ†å±‚æ¶æ„ï¼ˆMVVM æ¨¡å¼ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Presentation Layer          â”‚  â† UI å±‚ï¼ˆç”¨æˆ·çœ‹åˆ°çš„ï¼‰
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Screens  â”‚      â”‚ Widgets  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚                â”‚          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                  â–¼                  â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚         â”‚ ViewModels   â”‚            â”‚  â† çŠ¶æ€ç®¡ç†
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Data Layer                â”‚  â† æ•°æ®å±‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Models   â”‚      â”‚ Services â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚                â”‚          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                  â–¼                  â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚         â”‚  Supabase    â”‚            â”‚  â† åç«¯æœåŠ¡
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ä»£ç ç»„ç»‡ç¤ºä¾‹

### 1. æ•°æ®æ¨¡å‹å±‚ (`lib/models/`)

**ä½œç”¨**: å®šä¹‰æ•°æ®ç»“æ„

```dart
// lib/models/menu_item.dart
class MenuItem {
  final String id;
  final String name;
  final double price;
  final String imageUrl;
  
  MenuItem({
    required this.id,
    required this.name,
    required this.price,
    required this.imageUrl,
  });
  
  // ä» JSON åˆ›å»ºå¯¹è±¡
  factory MenuItem.fromJson(Map<String, dynamic> json) {
    return MenuItem(
      id: json['id'],
      name: json['name'],
      price: json['price'].toDouble(),
      imageUrl: json['image_url'],
    );
  }
}
```

### 2. æœåŠ¡å±‚ (`lib/services/`)

**ä½œç”¨**: ä¸ Supabase äº¤äº’ï¼Œè·å–æ•°æ®

```dart
// lib/services/menu_service.dart
import 'package:supabase_flutter/supabase_flutter.dart';
import '../models/menu_item.dart';

class MenuService {
  final _supabase = Supabase.instance.client;
  
  // è·å–èœå•åˆ—è¡¨
  Future<List<MenuItem>> getMenuItems() async {
    final response = await _supabase
        .from('menu_items')
        .select();
    
    return (response as List)
        .map((item) => MenuItem.fromJson(item))
        .toList();
  }
}
```

### 3. çŠ¶æ€ç®¡ç†å±‚ (`lib/providers/` æˆ– `lib/viewmodels/`)

**ä½œç”¨**: ç®¡ç† UI çŠ¶æ€å’Œä¸šåŠ¡é€»è¾‘

```dart
// lib/providers/menu_provider.dart (ä½¿ç”¨ Provider)
import 'package:flutter/material.dart';
import '../models/menu_item.dart';
import '../services/menu_service.dart';

class MenuProvider with ChangeNotifier {
  final MenuService _menuService = MenuService();
  List<MenuItem> _menuItems = [];
  bool _isLoading = false;
  
  List<MenuItem> get menuItems => _menuItems;
  bool get isLoading => _isLoading;
  
  Future<void> loadMenuItems() async {
    _isLoading = true;
    notifyListeners();
    
    try {
      _menuItems = await _menuService.getMenuItems();
    } catch (e) {
      // å¤„ç†é”™è¯¯
    } finally {
      _isLoading = false;
      notifyListeners();
    }
  }
}
```

### 4. UI å±‚ (`lib/screens/` å’Œ `lib/widgets/`)

**ä½œç”¨**: å±•ç¤ºç•Œé¢

```dart
// lib/screens/menu_screen.dart
import 'package:flutter/material.dart';
import 'package:provider/provider.dart';
import '../providers/menu_provider.dart';
import '../widgets/menu_item_card.dart';

class MenuScreen extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text('èœå•')),
      body: Consumer<MenuProvider>(
        builder: (context, provider, child) {
          if (provider.isLoading) {
            return Center(child: CircularProgressIndicator());
          }
          
          return ListView.builder(
            itemCount: provider.menuItems.length,
            itemBuilder: (context, index) {
              return MenuItemCard(item: provider.menuItems[index]);
            },
          );
        },
      ),
    );
  }
}
```

```dart
// lib/widgets/menu_item_card.dart
import 'package:flutter/material.dart';
import '../models/menu_item.dart';

class MenuItemCard extends StatelessWidget {
  final MenuItem item;
  
  const MenuItemCard({required this.item});
  
  @override
  Widget build(BuildContext context) {
    return Card(
      child: ListTile(
        leading: Image.network(item.imageUrl),
        title: Text(item.name),
        trailing: Text('Â¥${item.price}'),
      ),
    );
  }
}
```

---

## ğŸ”„ æ•°æ®æµå‘

```
ç”¨æˆ·æ“ä½œ
   â†“
Screen (UI)
   â†“
Provider/ViewModel (çŠ¶æ€ç®¡ç†)
   â†“
Service (æ•°æ®æœåŠ¡)
   â†“
Supabase (åç«¯)
   â†“
è¿”å›æ•°æ®
   â†“
Service è½¬æ¢ä¸º Model
   â†“
Provider æ›´æ–°çŠ¶æ€
   â†“
Screen è‡ªåŠ¨åˆ·æ–° UI
```

---

## ğŸ› ï¸ çŠ¶æ€ç®¡ç†æ–¹æ¡ˆé€‰æ‹©

### æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | éš¾åº¦ | æ¨èåº¦ | é€‚ç”¨åœºæ™¯ |
|------|------|--------|----------|
| **Provider** | â­ ç®€å• | â­â­â­â­ | ä¸­å°å‹é¡¹ç›® |
| **Riverpod** | â­â­ ä¸­ç­‰ | â­â­â­â­â­ | ä¸­å¤§å‹é¡¹ç›®ï¼ˆæ¨èï¼‰ |
| **GetX** | â­ ç®€å• | â­â­â­ | å¿«é€Ÿå¼€å‘ |
| **Bloc** | â­â­â­ å¤æ‚ | â­â­â­ | å¤§å‹é¡¹ç›® |

### æ¨èï¼šRiverpod

**ä¸ºä»€ä¹ˆé€‰æ‹© Riverpodï¼Ÿ**
- âœ… ç±»å‹å®‰å…¨
- âœ… ç¼–è¯‘æ—¶æ£€æŸ¥
- âœ… æ˜“äºæµ‹è¯•
- âœ… æ€§èƒ½ä¼˜ç§€
- âœ… å®˜æ–¹æ¨è

**å®‰è£…**:
```yaml
dependencies:
  flutter_riverpod: ^2.5.1
```

---

## ğŸ“‹ å¼€å‘æ­¥éª¤æ¸…å•

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºç›®å½•ç»“æ„
```bash
cd lib
mkdir config models screens widgets services providers routes
```

### ç¬¬äºŒæ­¥ï¼šé‡æ„ç°æœ‰ä»£ç 
1. åˆ›å»º `lib/config/supabase_config.dart`
2. å°† Supabase é…ç½®ä» `main.dart` ç§»å‡º
3. æ›´æ–° `main.dart` å¯¼å…¥é…ç½®

### ç¬¬ä¸‰æ­¥ï¼šé€‰æ‹©å¹¶å®‰è£…çŠ¶æ€ç®¡ç†
```bash
flutter pub add flutter_riverpod
# æˆ–
flutter pub add provider
```

### ç¬¬å››æ­¥ï¼šåˆ›å»ºç¬¬ä¸€ä¸ªåŠŸèƒ½æ¨¡å—
å»ºè®®ä»èœå•å±•ç¤ºå¼€å§‹ï¼š
1. åˆ›å»º `MenuItem` æ¨¡å‹
2. åˆ›å»º `MenuService` æœåŠ¡
3. åˆ›å»º `MenuProvider` çŠ¶æ€ç®¡ç†
4. åˆ›å»º `MenuScreen` é¡µé¢
5. åˆ›å»º `MenuItemCard` ç»„ä»¶

### ç¬¬äº”æ­¥ï¼šé…ç½®è·¯ç”±
ä½¿ç”¨ `go_router` æˆ– `flutter_riverpod` çš„è·¯ç”±åŠŸèƒ½

---

## ğŸ¨ æœ€ä½³å®è·µ

### 1. æ–‡ä»¶å‘½åè§„èŒƒ
- ä½¿ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿ï¼š`menu_item.dart`
- ç±»åä½¿ç”¨å¤§é©¼å³°ï¼š`MenuItem`
- æ–‡ä»¶åä¸ä¸»ç±»åå¯¹åº”

### 2. å¯¼å…¥é¡ºåº
```dart
// 1. Dart æ ‡å‡†åº“
import 'dart:async';

// 2. Flutter åŒ…
import 'package:flutter/material.dart';

// 3. ç¬¬ä¸‰æ–¹åŒ…
import 'package:provider/provider.dart';

// 4. é¡¹ç›®å†…éƒ¨æ–‡ä»¶
import '../models/menu_item.dart';
import '../services/menu_service.dart';
```

### 3. ä»£ç ç»„ç»‡åŸåˆ™
- **å•ä¸€èŒè´£**: æ¯ä¸ªç±»/æ–‡ä»¶åªåšä¸€ä»¶äº‹
- **DRY åŸåˆ™**: ä¸è¦é‡å¤ä»£ç ï¼Œæå–å…¬å…±ç»„ä»¶
- **å…³æ³¨ç‚¹åˆ†ç¦»**: UIã€ä¸šåŠ¡é€»è¾‘ã€æ•°æ®è®¿é—®åˆ†å¼€

---

## ğŸš¨ å¸¸è§é”™è¯¯é¿å…

### âŒ é”™è¯¯åšæ³•
```dart
// åœ¨ UI ä¸­ç›´æ¥è°ƒç”¨ Supabase
class MenuScreen extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    // âŒ ä¸è¦è¿™æ ·åšï¼
    final data = Supabase.instance.client.from('menu').select();
    return Text(data.toString());
  }
}
```

### âœ… æ­£ç¡®åšæ³•
```dart
// é€šè¿‡ Service å’Œ Provider ç®¡ç†
class MenuScreen extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    // âœ… ä½¿ç”¨ Provider è·å–æ•°æ®
    final menuItems = context.watch<MenuProvider>().menuItems;
    return ListView(...);
  }
}
```

---

## ğŸ“š ä¸‹ä¸€æ­¥å­¦ä¹ èµ„æº

1. **Flutter å®˜æ–¹æ¶æ„æŒ‡å—**
   - https://docs.flutter.dev/development/data-and-backend/state-mgmt

2. **Riverpod æ–‡æ¡£**
   - https://riverpod.dev/

3. **Supabase Flutter æ–‡æ¡£**
   - https://supabase.com/docs/reference/dart/introduction

---

## ğŸ’¡ å¿«é€Ÿå‚è€ƒ

### åˆ›å»ºæ–°åŠŸèƒ½çš„æ­¥éª¤

1. **å®šä¹‰æ•°æ®æ¨¡å‹** â†’ `lib/models/xxx_model.dart`
2. **åˆ›å»ºæ•°æ®æœåŠ¡** â†’ `lib/services/xxx_service.dart`
3. **åˆ›å»ºçŠ¶æ€ç®¡ç†** â†’ `lib/providers/xxx_provider.dart`
4. **åˆ›å»ºé¡µé¢** â†’ `lib/screens/xxx_screen.dart`
5. **åˆ›å»ºç»„ä»¶** â†’ `lib/widgets/xxx_widget.dart`
6. **é…ç½®è·¯ç”±** â†’ `lib/routes/app_router.dart`

---

**è®°ä½**: æ‰€æœ‰å®¢æˆ·ç«¯ä»£ç éƒ½åœ¨ `lib/` ç›®å½•ä¸‹ï¼ğŸ¯

